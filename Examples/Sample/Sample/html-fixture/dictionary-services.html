<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>
      UIReferenceLibraryViewController
      /DCSDictionaryRef//usr/share/dict/words : NSHipster
    </title>
    <meta name="description" content=
    "NSHipster is a journal of the overlooked bits in Objective-C and Cocoa. Updated weekly.">
    <meta name="author" content="Mattt Thompson">
    <meta name="revisit-after" content="3 days">
    <meta name="viewport" content="width=device-width">
    <link rel="license" href=
    "http://creativecommons.org/licenses/by-nc/3.0/">
    <link rel="alternate" hreflang="en-us" href=
    "http://nshipster.com">
    <link rel="alternate" hreflang="zh-Hans" href=
    "http://nshipster.cn">
    <link rel="alternate" hreflang="x-default" href=
    "http://nshipster.com">
    <link rel="alternate" type="application/rss+xml" title="RSS"
    href="http://nshipster.com/feed.xml">
    <link rel="stylesheet" href="/css/screen.css" type="text/css">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@NSHipster">
    <meta name="twitter:creator" content="@mattt">
    <meta name="twitter:title" content=
    "UIReferenceLibraryViewController /&lt;br/&gt;DCSDictionaryRef/&lt;br/&gt;/usr/share/dict/words">
    <meta name="twitter:description" content=
    "Though widely usurped of their 'go-to reference' status by the Internet, dictionaries and word lists serve an important role behind the scenes of functionality ranging from spell check, grammar check, and auto-correct to auto-summarization and semantic analysis.">
    <meta content="NSHipster" property="og:site_name">
    <meta content=
    "UIReferenceLibraryViewController /&lt;br/&gt;DCSDictionaryRef/&lt;br/&gt;/usr/share/dict/words"
    property="og:title">
    <meta content="http://nshipster.com/dictionary-services/"
    property="og:url">
    <meta content=
    "Though widely usurped of their 'go-to reference' status by the Internet, dictionaries and word lists serve an important role behind the scenes of functionality ranging from spell check, grammar check, and auto-correct to auto-summarization and semantic analysis."
    property="og:description">
    <meta property="st:title" content=
    "UIReferenceLibraryViewController /&lt;br/&gt;DCSDictionaryRef/&lt;br/&gt;/usr/share/dict/words">
    <meta property="st:type" content="article">
    <script type="text/javascript">
var _sf_startpt=(new Date()).getTime()
    </script>
    <script onload="try{Typekit.load();}catch(e){}" src=
    "//use.typekit.net/agk0bgp.js" type="text/javascript">
</script>
  </head>
  <body>
    <div role="container">
      <header role="banner">
        <h1 id="logo">
          <a href="/"><acronym title="NeXTSTEP/Sun">NS</acronym>
          <strong>Hipster</strong> <img id="moustache" src=
          "//cdn.nshipster.com/images/moustache.svg" width="200"
          height="150" data-author=
          "http://thenounproject.com/bnhw"></a>
        </h1>
        <form>
          <input type="text" id="st-search-input" class=
          "st-search-input">
        </form>
      </header>
      <div id="main" role="main">
        <article>
          <header>
            <h1>
              <a href=
              "/dictionary-services/">UIReference​Library​View​Controller
              /<br>
              DCSDictionary​Ref/<br>
              /usr/share/dict/words</a>
            </h1>
            <h2>
              Written by <a href="http://mattt.me/">Mattt
              Thompson</a> on <time pubdate=
              "2014-03-10 00:00:00 -0700">Mar 10<span>th</span>,
              2014</time>
            </h2>
          </header>
          <div class="content" data-swiftype-index="true">
            <p>
              This week's article is about dictionaries. Not the
              <code>NSDictionary</code> /
              <code>CFDictionaryRef</code> we encounter everyday,
              but those distant lexicographic vestiges of school
              days past.
            </p>
            <blockquote>
              <p>
                But seriously, why are dictionaries called that,
                anyway? Why can't we just settle on
                <code>Hash</code>, like those nice Ruby folks?
                What's that? Semantic overlap with hashing
                functions and cryptographic digests? Well,
                dictionary isn't <em>that</em> bad. Anything other
                than "associative arrays", I reckon.
              </p>
            </blockquote>
            <p>
              Though widely usurped of their "go-to reference"
              status by the Internet, dictionaries and word lists
              serve an important role behind the scenes of
              functionality ranging from spell check, grammar
              check, and auto-correct to auto-summarization and
              semantic analysis. So, for your reference, here's a
              look at the ways and means by which computers give
              meaning to the world through words, in Unix, Mac OS
              X, and iOS.
            </p>
            <hr>
            <h2>
              Unix
            </h2>
            <p>
              Nearly all Unix distributions include a small
              collection newline-delimited list of words. On Mac OS
              X, these can be found at
              <code>/usr/share/dict</code>:
            </p>
            <div class="highlight">
              <pre>
<code class="text language-text" data-lang=
"text">$ ls /usr/share/dict
    README
    connectives
    propernames
    web2
    web2a
    words@ -&gt; web2
</code>
</pre>
            </div>
            <p>
              Symlinked to <code>words</code> is the
              <code>web2</code> word list, which, though not
              exhaustive, is still a sizable corpus:
            </p>
            <div class="highlight">
              <pre>
<code class="text language-text" data-lang=
"text">$ wc /usr/share/dict/words
    235886  235886 2493109
</code>
</pre>
            </div>
            <p>
              Skimming with <code>head</code> shows what fun lies
              herein. Such excitement is rarely so palpable as it
              is among words beginning with "a":
            </p>
            <div class="highlight">
              <pre>
<code class="text language-text" data-lang=
"text">$ head /usr/share/dict/words
    A
    a
    aa
    aal
    aalii
    aam
    Aani
    aardvark
    aardwolf
    Aaron
</code>
</pre>
            </div>
            <p>
              These giant, system-provided text files make it easy
              to <code>grep</code> crossword puzzle clues, generate
              mnemonic pass phrases, and seed databases, but from a
              user perspective, <code>/usr/share/dict</code>'s
              monolingualism and lack of associated meaning make it
              less than useful for everyday use.
            </p>
            <p>
              Mac OS X builds upon this with its own system
              dictionaries. Never one to disappoint, the operating
              system's penchant for extending Unix functionality
              through strategically placed bundles and plist files
              is in full force with how dictionaries are
              distributed.
            </p>
            <hr>
            <h2>
              OS X
            </h2>
            <p>
              The Mac OS X analog to <code>/usr/share/dict</code>
              can be found in <code>/Library/Dictionaries</code>. A
              quick peek into the shared system dictionaries
              demonstrates one immediate improvement over Unix, by
              acknowledging the existence of languages other than
              English:
            </p>
            <div class="highlight">
              <pre>
<code class="text language-text" data-lang=
"text">$ ls /Library/Dictionaries/

    Apple Dictionary.dictionary/
    Diccionario General de la Lengua Española Vox.dictionary/
    Duden Dictionary Data Set I.dictionary/
    Dutch.dictionary/
    Italian.dictionary/
    Korean - English.dictionary/
    Korean.dictionary/
    Multidictionnaire de la langue française.dictionary/
    New Oxford American Dictionary.dictionary/
    Oxford American Writer's Thesaurus.dictionary/
    Oxford Dictionary of English.dictionary/
    Oxford Thesaurus of English.dictionary/
    Sanseido Super Daijirin.dictionary/
    Sanseido The WISDOM English-Japanese Japanese-English Dictionary.dictionary/
    Simplified Chinese - English.dictionary/
    The Standard Dictionary of Contemporary Chinese.dictionary/
</code>
</pre>
            </div>
            <p>
              Mac OS X ships with dictionaries in Chinese, English,
              French, Dutch, Italian, Japanese, Korean, as well as
              an English thesaurus and a special dictionary for
              Apple-specific terminology.
            </p>
            <p>
              Diving deeper into the rabbit hole, we peruse the
              <code>.dictionary</code> bundles to see them for what
              they really are:
            </p>
            <div class="highlight">
              <pre>
<code class="text language-text" data-lang=
"text">$ ls "/Library/Dictionaries/New Oxford American Dictionary.dictionary/Contents"

    Body.data
    DefaultStyle.css
    EntryID.data
    EntryID.index
    Images/
    Info.plist
    KeyText.data
    KeyText.index
    Resources/
    _CodeSignature/
    version.plist
</code>
</pre>
            </div>
            <p>
              A filesystem autopsy reveals some interesting
              implementation details. In the case of the New Oxford
              American Dictionary in particular, contents include:
            </p>
            <ul>
              <li>Binary-encoded <code>KeyText.data</code>, <code>
                KeyText.index</code>, &amp;
                <code>Content.data</code>
              </li>
              <li>CSS for styling entries
              </li>
              <li>1207 images, from A-Frame to Zither.
              </li>
              <li>Preference to switch between <a href=
              "http://en.wikipedia.org/wiki/Pronunciation_respelling_for_English">
                US English Diacritical Pronunciation</a> and
                <a href=
                "http://en.wikipedia.org/wiki/International_Phonetic_Alphabet">
                IPA</a> (International Phonetic Alphabet)
              </li>
              <li>Manifest &amp; signature for dictionary contents
              </li>
            </ul>
            <p>
              Normally, proprietary binary encoding would be the
              end of the road in terms of what one could reasonably
              do with data, but luckily, Core Services provides
              APIs to read this information.
            </p>
            <h4>
              Getting Definition of Word
            </h4>
            <p>
              To get the definition of a word on Mac OS X, one can
              use the <code>DCSCopyTextDefinition</code> function,
              found in the Core Services framework:
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class=
"cp">#import &lt;CoreServices/CoreServices.h&gt;</span>

<span class="n">NSString</span> <span class=
"o">*</span><span class="n">word</span> <span class=
"o">=</span> <span class="s">@"apple"</span><span class=
"p">;</span>
<span class="n">NSString</span> <span class=
"o">*</span><span class="n">definition</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSString</span> <span class="o">*</span><span class=
"p">)</span><span class=
"n">DCSCopyTextDefinition</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="n">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">word</span><span class="p">,</span> <span class="n">CFRangeMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">word</span> <span class="n">length</span><span class="p">]));</span>
<span class="n">NSLog</span><span class="p">(</span><span class=
"s">@"%@"</span><span class="p">,</span> <span class=
"n">definition</span><span class="p">);</span>
</code>
</pre>
            </div>
            <p>
              Wait, where did all of those great dictionaries go?
            </p>
            <p>
              Well, they all disappeared into that first
              <code>NULL</code> argument. One might expect to
              provide a <code>DCSCopyTextDefinition</code> type
              here, as prescribed by the function definition.
              However, there are no public functions to construct
              or copy such a type, making <code>NULL</code> the
              only available option. The documentation is as clear
              as it is stern:
            </p>
            <blockquote>
              <p>
                This parameter is reserved for future use, so pass
                <code>NULL</code>. Dictionary Services searches in
                all active dictionaries.
              </p>
            </blockquote>
            <p>
              "Dictionary Services searches in <strong>all active
              dictionaries</strong>", you say? Sounds like a
              loophole!
            </p>
            <h4>
              Setting Active Dictionaries
            </h4>
            <p>
              Now, there's nothing programmers love to hate to love
              more than the practice of exploiting loopholes to
              side-step Apple platform restrictions. Behold: an
              entirely error-prone approach to getting, say,
              thesaurus results instead of the first definition
              available in the standard dictionary:
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class="n">NSUserDefaults</span> <span class=
"o">*</span><span class="n">userDefaults</span> <span class=
"o">=</span> <span class="p">[</span><span class=
"n">NSUserDefaults</span> <span class=
"n">standardUserDefaults</span><span class="p">];</span>
<span class="n">NSMutableDictionary</span> <span class=
"o">*</span><span class=
"n">dictionaryPreferences</span> <span class=
"o">=</span> <span class="p">[[</span><span class=
"n">userDefaults</span> <span class=
"n">persistentDomainForName</span><span class=
"o">:</span><span class=
"s">@"com.apple.DictionaryServices"</span><span class=
"p">]</span> <span class="n">mutableCopy</span><span class=
"p">];</span>
<span class="n">NSArray</span> <span class="o">*</span><span class=
"n">activeDictionaries</span> <span class="o">=</span> <span class=
"p">[</span><span class=
"n">dictionaryPreferences</span> <span class=
"n">objectForKey</span><span class="o">:</span><span class=
"s">@"DCSActiveDictionaries"</span><span class="p">];</span>
<span class="n">dictionaryPreferences</span><span class=
"p">[</span><span class=
"s">@"DCSActiveDictionaries"</span><span class=
"p">]</span> <span class="o">=</span> <span class=
"p">@[</span><span class=
"s">@"/Library/Dictionaries/Oxford American Writer's Thesaurus.dictionary"</span><span class="p">];</span>
<span class="p">[</span><span class=
"n">userDefaults</span> <span class=
"n">setPersistentDomain</span><span class="o">:</span><span class=
"n">dictionaryPreferences</span> <span class=
"n">forName</span><span class="o">:</span><span class=
"s">@"com.apple.DictionaryServices"</span><span class="p">];</span>
<span class="p">{</span>
    <span class="n">NSString</span> <span class=
"o">*</span><span class="n">word</span> <span class=
"o">=</span> <span class="s">@"apple"</span><span class=
"p">;</span>
    <span class="n">NSString</span> <span class=
"o">*</span><span class="n">definition</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSString</span> <span class="o">*</span><span class=
"p">)</span><span class=
"n">DCSCopyTextDefinition</span><span class="p">(</span><span class="nb">NULL</span><span class="p">,</span> <span class="p">(</span><span class="n">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">word</span><span class="p">,</span> <span class="n">CFRangeMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">word</span> <span class="n">length</span><span class="p">]));</span>
    <span class="n">NSLog</span><span class=
"p">(</span><span class="s">@"%@"</span><span class=
"p">,</span> <span class="n">definition</span><span class=
"p">);</span>
<span class="p">}</span>
<span class="n">dictionaryPreferences</span><span class=
"p">[</span><span class=
"s">@"DCSActiveDictionaries"</span><span class=
"p">]</span> <span class="o">=</span> <span class=
"n">activeDictionaries</span><span class="p">;</span>
<span class="p">[</span><span class=
"n">userDefaults</span> <span class=
"n">setPersistentDomain</span><span class="o">:</span><span class=
"n">dictionaryPreferences</span> <span class=
"n">forName</span><span class="o">:</span><span class=
"s">@"com.apple.DictionaryServices"</span><span class="p">];</span>
</code>
</pre>
            </div>
            <p>
              "But this is Mac OS X, a platform whose manifest
              destiny cannot be contained by meager sandboxing
              attempts from Cupertino!", you cry. "Isn't there a
              more civilized approach? Like, say, private APIs?"
            </p>
            <p>
              Why yes, yes there are.
            </p>
            <h3>
              Private APIs
            </h3>
            <p>
              Not publicly exposed, but still available through
              Core Services are a number of functions that cut
              closer to the dictionary services functionality that
              we crave:
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class="k">extern</span> <span class=
"n">CFArrayRef</span> <span class=
"nf">DCSCopyAvailableDictionaries</span><span class="p">();</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSDictionaryGetName</span><span class=
"p">(</span><span class="n">DCSDictionaryRef</span> <span class=
"n">dictionary</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSDictionaryGetShortName</span><span class=
"p">(</span><span class="n">DCSDictionaryRef</span> <span class=
"n">dictionary</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">DCSDictionaryRef</span> <span class=
"nf">DCSDictionaryCreate</span><span class="p">(</span><span class=
"n">CFURLRef</span> <span class="n">url</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSDictionaryGetName</span><span class=
"p">(</span><span class="n">DCSDictionaryRef</span> <span class=
"n">dictionary</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFArrayRef</span> <span class=
"nf">DCSCopyRecordsForSearchString</span><span class=
"p">(</span><span class="n">DCSDictionaryRef</span> <span class=
"n">dictionary</span><span class="p">,</span> <span class=
"n">CFStringRef</span> <span class="n">string</span><span class=
"p">,</span> <span class="kt">void</span> <span class=
"o">*</span><span class="p">,</span> <span class=
"kt">void</span> <span class="o">*</span><span class="p">);</span>

<span class="k">extern</span> <span class=
"n">CFDictionaryRef</span> <span class=
"nf">DCSCopyDefinitionMarkup</span><span class=
"p">(</span><span class="n">DCSDictionaryRef</span> <span class=
"n">dictionary</span><span class="p">,</span> <span class=
"n">CFStringRef</span> <span class="n">record</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordCopyData</span><span class="p">(</span><span class=
"n">CFTypeRef</span> <span class="n">record</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordCopyDataURL</span><span class=
"p">(</span><span class="n">CFTypeRef</span> <span class=
"n">record</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetAnchor</span><span class="p">(</span><span class=
"n">CFTypeRef</span> <span class="n">record</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetAssociatedObj</span><span class=
"p">(</span><span class="n">CFTypeRef</span> <span class=
"n">record</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetHeadword</span><span class=
"p">(</span><span class="n">CFTypeRef</span> <span class=
"n">record</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetRawHeadword</span><span class=
"p">(</span><span class="n">CFTypeRef</span> <span class=
"n">record</span><span class="p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetString</span><span class="p">(</span><span class=
"n">CFTypeRef</span> <span class="n">record</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">CFStringRef</span> <span class=
"nf">DCSRecordGetTitle</span><span class="p">(</span><span class=
"n">CFTypeRef</span> <span class="n">record</span><span class=
"p">);</span>
<span class="k">extern</span> <span class=
"n">DCSDictionaryRef</span> <span class=
"nf">DCSRecordGetSubDictionary</span><span class=
"p">(</span><span class="n">CFTypeRef</span> <span class=
"n">record</span><span class="p">);</span>
</code>
</pre>
            </div>
            <p>
              Private as they are, these functions aren't about to
              start documenting themselves, so let's take a look at
              how they're used:
            </p>
            <h4>
              Getting Available Dictionaries
            </h4>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class="n">NSMapTable</span> <span class=
"o">*</span><span class=
"n">availableDictionariesKeyedByName</span> <span class=
"o">=</span>
    <span class="p">[</span><span class=
"n">NSMapTable</span> <span class=
"n">mapTableWithKeyOptions</span><span class=
"o">:</span><span class="n">NSPointerFunctionsCopyIn</span>
                          <span class=
"nl">valueOptions:</span><span class=
"n">NSPointerFunctionsObjectPointerPersonality</span><span class=
"p">];</span>

<span class="k">for</span> <span class="p">(</span><span class=
"kt">id</span> <span class="n">dictionary</span> <span class=
"k">in</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSArray</span> <span class="o">*</span><span class=
"p">)</span><span class=
"n">DCSCopyAvailableDictionaries</span><span class=
"p">())</span> <span class="p">{</span>
    <span class="n">NSString</span> <span class=
"o">*</span><span class="n">name</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge</span> <span class="n">NSString</span> <span class=
"o">*</span><span class="p">)</span><span class=
"n">DCSDictionaryGetName</span><span class=
"p">((</span><span class="n">__bridge</span> <span class=
"n">DCSDictionaryRef</span><span class="p">)</span><span class=
"n">dictionary</span><span class="p">);</span>
    <span class="p">[</span><span class=
"n">availableDictionariesKeyedByName</span> <span class=
"n">setObject</span><span class="o">:</span><span class=
"n">dictionary</span> <span class="n">forKey</span><span class=
"o">:</span><span class="n">name</span><span class="p">];</span>
<span class="p">}</span>
</code>
</pre>
            </div>
            <h4>
              Getting Definition for Word
            </h4>
            <p>
              With instances of the elusive
              <code>DCSDictionaryRef</code> type available at our
              disposal, we can now see what all of the fuss is
              about with that first argument in
              <code>DCSCopyTextDefinition</code>:
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class="n">NSString</span> <span class=
"o">*</span><span class="n">word</span> <span class=
"o">=</span> <span class="s">@"apple"</span><span class=
"p">;</span>

<span class="k">for</span> <span class="p">(</span><span class=
"n">NSString</span> <span class="o">*</span><span class=
"n">name</span> <span class="k">in</span> <span class=
"n">availableDictionariesKeyedByName</span><span class=
"p">)</span> <span class="p">{</span>
    <span class="kt">id</span> <span class=
"n">dictionary</span> <span class="o">=</span> <span class=
"p">[</span><span class=
"n">availableDictionariesKeyedByName</span> <span class=
"n">objectForKey</span><span class="o">:</span><span class=
"n">name</span><span class="p">];</span>

    <span class="n">CFRange</span> <span class=
"n">termRange</span> <span class="o">=</span> <span class=
"n">DCSGetTermRangeInString</span><span class=
"p">((</span><span class="n">__bridge</span> <span class=
"n">DCSDictionaryRef</span><span class="p">)</span><span class=
"n">dictionary</span><span class="p">,</span> <span class=
"p">(</span><span class="n">__bridge</span> <span class=
"n">CFStringRef</span><span class="p">)</span><span class=
"n">word</span><span class="p">,</span> <span class=
"mi">0</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class=
"n">termRange</span><span class="p">.</span><span class=
"n">location</span> <span class="o">==</span> <span class=
"n">kCFNotFound</span><span class="p">)</span> <span class=
"p">{</span>
        <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">NSString</span> <span class=
"o">*</span><span class="n">term</span> <span class=
"o">=</span> <span class="p">[</span><span class=
"n">word</span> <span class=
"n">substringWithRange</span><span class="o">:</span><span class=
"n">NSMakeRange</span><span class="p">(</span><span class=
"n">termRange</span><span class="p">.</span><span class=
"n">location</span><span class="p">,</span> <span class=
"n">termRange</span><span class="p">.</span><span class=
"n">length</span><span class="p">)];</span>

    <span class="n">NSArray</span> <span class=
"o">*</span><span class="n">records</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSArray</span> <span class="o">*</span><span class=
"p">)</span><span class=
"n">DCSCopyRecordsForSearchString</span><span class=
"p">((</span><span class="n">__bridge</span> <span class=
"n">DCSDictionaryRef</span><span class="p">)</span><span class=
"n">dictionary</span><span class="p">,</span> <span class=
"p">(</span><span class="n">__bridge</span> <span class=
"n">CFStringRef</span><span class="p">)</span><span class=
"n">term</span><span class="p">,</span> <span class=
"nb">NULL</span><span class="p">,</span> <span class=
"nb">NULL</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class=
"n">records</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class=
"p">(</span><span class="kt">id</span> <span class=
"n">record</span> <span class="k">in</span> <span class=
"n">records</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">NSString</span> <span class=
"o">*</span><span class="n">headword</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge</span> <span class="n">NSString</span> <span class=
"o">*</span><span class="p">)</span><span class=
"n">DCSRecordGetHeadword</span><span class=
"p">((</span><span class="n">__bridge</span> <span class=
"n">CFTypeRef</span><span class="p">)</span><span class=
"n">record</span><span class="p">);</span>
            <span class="k">if</span> <span class=
"p">(</span><span class="n">headword</span><span class=
"p">)</span> <span class="p">{</span>
                <span class="n">NSString</span> <span class=
"o">*</span><span class="n">definition</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSString</span><span class="o">*</span><span class=
"p">)</span><span class=
"n">DCSCopyTextDefinition</span><span class="p">((</span><span class="n">__bridge</span> <span class="n">DCSDictionaryRef</span><span class="p">)</span><span class="n">dictionary</span><span class="p">,</span> <span class="p">(</span><span class="n">__bridge</span> <span class="n">CFStringRef</span><span class="p">)</span><span class="n">headword</span><span class="p">,</span> <span class="n">CFRangeMake</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">[</span><span class="n">headword</span> <span class="n">length</span><span class="p">]));</span>
                <span class="n">NSLog</span><span class=
"p">(</span><span class="s">@"%@: %@"</span><span class=
"p">,</span> <span class="n">name</span><span class=
"p">,</span> <span class="n">definition</span><span class=
"p">);</span>

                <span class="n">NSString</span> <span class=
"o">*</span><span class="n">HTML</span> <span class=
"o">=</span> <span class="p">(</span><span class=
"n">__bridge_transfer</span> <span class=
"n">NSString</span><span class="o">*</span><span class=
"p">)</span><span class="n">DCSRecordCopyData</span><span class=
"p">((</span><span class="n">__bridge</span> <span class=
"n">DCSDictionaryRef</span><span class="p">)</span><span class=
"n">dictionary</span><span class="p">,</span> <span class=
"p">(</span><span class="n">__bridge</span> <span class=
"n">CFStringRef</span><span class="p">)</span><span class=
"n">headword</span><span class="p">,</span> <span class=
"n">CFRangeMake</span><span class="p">(</span><span class=
"mi">0</span><span class="p">,</span> <span class=
"p">[</span><span class="n">headword</span> <span class=
"n">length</span><span class="p">]));</span>
                <span class="n">NSLog</span><span class=
"p">(</span><span class="s">@"%@: %@"</span><span class=
"p">,</span> <span class="n">name</span><span class=
"p">,</span> <span class="n">definition</span><span class=
"p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code>
</pre>
            </div>
            <p>
              Most surprising from this experimentation is the
              ability to access the raw HTML for entries, which
              combined with a dictionary's bundled CSS, produces
              the result seen in Dictionary.app.
            </p>
            <p>
              <img src=
              "http://nshipster.s3.amazonaws.com/dictionary.png"
              alt="Entry for &quot;apple&quot; in Dictionary.app">
            </p>
            <blockquote>
              <p>
                For any fellow linguistics nerds or markup curious
                folks out there, here's <a href=
                "https://gist.github.com/mattt/9453538">the HTML of
                the entry for the word "apple"</a>.
              </p>
            </blockquote>
            <p>
              In the process of writing this article, I
              <em>accidentally</em> created <a href=
              "https://github.com/mattt/DictionaryKit">an
              Objective-C wrapper</a> around this forbidden fruit
              (so forbidden by our favorite fruit company, so don't
              try submitting this to the App Store).
            </p>
            <hr>
            <h2>
              iOS
            </h2>
            <p>
              iOS development is a decidedly more by-the-books
              affair, so attempting to reverse-engineer the
              platform would be little more than an academic
              exercise. Fortunately, a good chunk of functionality
              is available (as of iOS 5) through the obscure UIKit
              class <code>UIReferenceLibraryViewController</code>.
            </p>
            <p>
              <code>UIReferenceLibraryViewController</code> is
              similar to an
              <code>MFMessageComposeViewController</code>, in that
              provides a minimally-configurable view controller
              around system functionality, intended to be presented
              modally.
            </p>
            <p>
              Simply initialize with the desired term:
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class=
"n">UIReferenceLibraryViewController</span> <span class=
"o">*</span><span class=
"n">referenceLibraryViewController</span> <span class="o">=</span>
    <span class="p">[[</span><span class=
"n">UIReferenceLibraryViewController</span> <span class=
"n">alloc</span><span class="p">]</span> <span class=
"n">initWithTerm</span><span class="o">:</span><span class=
"s">@"apple"</span><span class="p">];</span>
<span class="p">[</span><span class=
"n">viewController</span> <span class=
"n">presentViewController</span><span class=
"o">:</span><span class="n">referenceLibraryViewController</span>
                             <span class=
"nl">animated:</span><span class="nb">YES</span>
                           <span class=
"nl">completion:</span><span class="nb">nil</span><span class=
"p">];</span>
</code>
</pre>
            </div>
            <p>
              <img src=
              "http://nshipster.s3.amazonaws.com/uireferencelibraryviewcontroller-1.png"
              alt="Presenting a UIReferenceLibraryViewController">
            </p>
            <p>
              This is the same behavior that one might encounter by
              tapping the "Define" <code>UIMenuItem</code> on a
              highlighted word in a <code>UITextView</code>.
            </p>
            <blockquote>
              <p>
                Tapping on "Manage" brings up a view to download
                additional dictionaries.
              </p>
            </blockquote>
            <p>
              <img src=
              "http://nshipster.s3.amazonaws.com/uireferencelibraryviewcontroller-2.png"
              alt="Presenting a UIReferenceLibraryViewController">
            </p>
            <p>
              <code>UIReferenceLibraryViewController</code> also
              provides the class method
              <code>dictionaryHasDefinitionForTerm:</code>. A
              developer would do well to call this before
              presenting a dictionary view controller that will
              inevitably have nothing to display.
            </p>
            <div class="highlight">
              <pre>
<code class="objective-c language-objective-c" data-lang=
"objective-c"><span class="p">[</span><span class=
"n">UIReferenceLibraryViewController</span> <span class=
"n">dictionaryHasDefinitionForTerm</span><span class=
"o">:</span><span class="s">@"apple"</span><span class=
"p">];</span>
</code>
</pre>
            </div>
            <blockquote>
              <p>
                In both cases, it appears that
                <code>UIReferenceLibraryViewController</code> will
                do its best to normalize the search term, so
                stripping whitespace or changing to lowercase
                should not be necessary.
              </p>
            </blockquote>
            <hr>
            <p>
              From Unix word lists to their evolved
              <code>.dictionary</code> bundles on OS X (and
              presumably iOS), words are as essential to
              application programming as mathematical constants and
              the "Sosumi" alert noise. Consider how the
              aforementioned APIs can be integrated into your own
              app, or used to create a kind of app you hadn't
              previously considered. There are a <a href=
              "http://nshipster.com/nslocalizedstring/">wealth</a>
              <a href=
              "http://nshipster.com/nslinguistictagger/">of</a>
              <a href=
              "http://nshipster.com/search-kit/">linguistic</a>
              <a href=
              "http://nshipster.com/uilocalizedindexedcollation/">technologies</a>
              baked into Apple's platforms, so take advantage of
              them.
            </p>
          </div>
          <aside>
            <a href="https://twitter.com/share" class=
            "twitter-share-button" data-url=
            "http://nshipster.com/dictionary-services/" data-via=
            "NSHipster" data-size="large">Tweet</a> <script type=
            "text/javascript">
!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
            </script>
          </aside>
          <footer id="book" class="promotion">
            <a href="https://gum.co/cfhipsterref"></a>
            <div id="cfhipsterref-cover"></div>
            <div>
              <hgroup>
                <h1>
                  <a href=
                  "https://gum.co/cfhipsterref">CFHipsterRef:
                  Low-Level Programming on<br>
                  iOS &amp; Mac OS X</a>
                </h1>
                <h2>
                  Available May 27th, 2014
                </h2>
              </hgroup>
              <p>
                Perfect for intermediate and expert developers
                wanting to take a deeper dive into advanced topics,
                <em>CFHipsterRef: Low-Level Programming on iOS
                &amp; Mac OS X</em> covers the core technologies
                powering Cocoa, Objective-C, and the operating
                system itself, including Core Bluetooth,
                Accelerate, and the Objective-C runtime.
              </p><button onclick=
              "javascript:window.location.href='https://gum.co/cfhipsterref'">Pre-Order
              Now</button>
            </div>
          </footer>
        </article>
      </div>
      <footer role="contentinfo">
        <section class="credits colophon">
          <p>
            Created by <a href="http://mattt.me">Mattt
            Thompson</a>, and released under a <a href=
            "http://creativecommons.org/licenses/by-nc/3.0/" rel=
            "license">Creative Commons BY-NC License</a>. <a href=
            "https://plus.google.com/106751358503565042647?rel=author"
            style="display: none;"></a>
          </p>
          <p>
            Articles also available in <a href=
            "http://nshipster.cn" hreflang="zh-Hans">中文</a>.
          </p>
        </section>
        <aside class="links">
          <a href="https://github.com/NSHipster/articles/issues"
          class="icon-github" title="Pull Requests Welcome"
          aria-hidden="true"></a> <a href="/feed.xml" class=
          "icon-feed" title="RSS" aria-hidden="true"></a>
        </aside>
        <section class="archive" role="navigation">
          <div>
            <h2>
              Foundation
            </h2>
            <ul>
              <li>
                <a href="/nsurl/">NSURL /<br>
                NSURLComponents</a>
              </li>
              <li>
                <a href=
                "/nstemporarydirectory/">NSTemporaryDirectory /<br>
                NSItemReplacementDirectory /<br>
                mktemp(3)</a>
              </li>
              <li>
                <a href="/nsrange/">NSRange</a>
              </li>
              <li>
                <a href=
                "/nsnotification-and-nsnotificationcenter/">NSNotification
                &amp;<br>
                NSNotificationCenter</a>
              </li>
              <li>
                <a href="/nsfilemanager/">NSFileManager</a>
              </li>
              <li>
                <a href="/nsformatter/">NSFormatter</a>
              </li>
              <li>
                <a href="/nserror/">NSError</a>
              </li>
              <li>
                <a href="/key-value-observing/">Key-Value
                Observing</a>
              </li>
              <li>
                <a href="/nshashtable-and-nsmaptable/">NSHashTable
                &amp;<br>
                NSMapTable</a>
              </li>
              <li>
                <a href="/nspredicate/">NSPredicate</a>
              </li>
              <li>
                <a href="/nsexpression/">NSExpression</a>
              </li>
              <li>
                <a href="/enumerators/">NSFastEnumeration /<br>
                NSEnumerator /<br>
                -enumerateObjectsUsingBlock:</a>
              </li>
              <li>
                <a href="/uuid-udid-unique-identifier/">NSUUID
                /<br>
                CFUUIDRef /<br>
                UIDevice -uniqueIdentifier /<br>
                -identifierForVendor</a>
              </li>
              <li>
                <a href="/nsdatadetector/">NSDataDetector</a>
              </li>
              <li>
                <a href="/nscoding/">NSCoding / NSKeyedArchiver</a>
              </li>
              <li>
                <a href="/nssecurecoding/">NSSecureCoding</a>
              </li>
              <li>
                <a href=
                "/nsassertionhandler/">NSAssertionHandler</a>
              </li>
              <li>
                <a href="/nsurlcache/">NSURLCache</a>
              </li>
              <li>
                <a href="/nsvalue/">NSValue</a>
              </li>
              <li>
                <a href="/nslocalizedstring/">NSLocalizedString</a>
              </li>
              <li>
                <a href="/instancetype/">instancetype</a>
              </li>
              <li>
                <a href="/kvc-collection-operators/">KVC Collection
                Operators</a>
              </li>
              <li>
                <a href="/nsorderedset/">NSOrderedSet</a>
              </li>
              <li>
                <a href="/ns_enum-ns_options/">NS_ENUM &amp;
                NS_OPTIONS</a>
              </li>
              <li>
                <a href=
                "/nsvaluetransformer/">NSValueTransformer</a>
              </li>
              <li>
                <a href="/nsurlprotocol/">NSURLProtocol</a>
              </li>
              <li>
                <a href=
                "/nslinguistictagger/">NSLinguisticTagger</a>
              </li>
              <li>
                <a href="/nscharacterset/">NSCharacterSet</a>
              </li>
              <li>
                <a href="/nslocale/">NSLocale</a>
              </li>
              <li>
                <a href="/nsoperation/">NSOperation</a>
              </li>
              <li>
                <a href=
                "/nsincrementalstore/">NSIncrementalStore</a>
              </li>
              <li>
                <a href="/nsdatecomponents/">NSDateComponents</a>
              </li>
              <li>
                <a href="/nssortdescriptor/">NSSortDescriptor</a>
              </li>
              <li>
                <a href="/nscache/">NSCache</a>
              </li>
              <li>
                <a href="/nsindexset/">NSIndexSet</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              CoreFoundation
            </h2>
            <ul>
              <li>
                <a href="/cfbag/">CFBag</a>
              </li>
              <li>
                <a href="/cfstringtransform/">CFStringTransform</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              CoreGraphics
            </h2>
            <ul>
              <li>
                <a href="/cggeometry/">CGGeometry</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              UIKit
            </h2>
            <ul>
              <li>
                <a href=
                "/launch-options/">UIApplicationDelegate<br>
                launchOptions</a>
              </li>
              <li>
                <a href="/uimenucontroller/">UIMenuController</a>
              </li>
              <li>
                <a href="/uiappearance/">UIAppearance</a>
              </li>
              <li>
                <a href=
                "/uilocalizedindexedcollation/">UILocalizedIndexedCollation</a>
              </li>
              <li>
                <a href="/uicollectionview/">UICollectionView</a>
              </li>
              <li>
                <a href="/uiaccessibility/">UIAccessibility</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              Objective-C
            </h2>
            <ul>
              <li>
                <a href="/namespacing/">Namespacing</a>
              </li>
              <li>
                <a href="/extended-file-attributes/">Extended File
                Attributes</a>
              </li>
              <li>
                <a href="/equality/">Equality</a>
              </li>
              <li>
                <a href="/random/">rand(3) / random(3) /
                arc4random(3) / et al.</a>
              </li>
              <li>
                <a href="/object-subscripting/">Object
                Subscripting</a>
              </li>
              <li>
                <a href="/bool/">BOOL / bool / Boolean /
                NSCFBoolean</a>
              </li>
              <li>
                <a href="/c-storage-classes/">C Storage Classes</a>
              </li>
              <li>
                <a href="/type-encodings/">Type Encodings</a>
              </li>
              <li>
                <a href="/__attribute__/">__attribute__</a>
              </li>
              <li>
                <a href="/nil/">nil / Nil / NULL / NSNull</a>
              </li>
              <li>
                <a href="/at-compiler-directives/">@</a>
              </li>
              <li>
                <a href="/pragma/">#pragma</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              Open Source
            </h2>
            <ul>
              <li>
                <a href="/xctool/">xctool</a>
              </li>
              <li>
                <a href="/afnetworking-2/">AFNetworking 2.0</a>
              </li>
              <li>
                <a href="/core-data-libraries-and-utilities/">Core
                Data Libraries &amp; Utilities</a>
              </li>
              <li>
                <a href="/gpuimage/">GPUImage</a>
              </li>
              <li>
                <a href="/reactivecocoa/">ReactiveCocoa</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              Testing
            </h2>
            <ul>
              <li>
                <a href="/unit-testing/">Unit Testing</a>
              </li>
            </ul>
          </div>
          <div>
            <h2>
              Miscellanea
            </h2>
            <ul>
              <li>
                <a href=
                "/avspeechsynthesizer/">AVSpeechSynthesizer</a>
              </li>
              <li>
                <a href="/empathy/">Empathy</a>
              </li>
              <li>
                <a href=
                "/dictionary-services/">UIReferenceLibraryViewController
                /<br>
                DCSDictionaryRef/<br>
                /usr/share/dict/words</a>
              </li>
              <li>
                <a href="/method-swizzling/">Method Swizzling</a>
              </li>
              <li>
                <a href="/associated-objects/">Associated
                Objects</a>
              </li>
              <li>
                <a href=
                "/mktileoverlay-mkmapsnapshotter-mkdirections/">MKTileOverlay,<br>
                MKMapSnapshotter &amp;<br>
                MKDirections</a>
              </li>
              <li>
                <a href="/stewardship/">Stewardship</a>
              </li>
              <li>
                <a href="/colophon/">Colophon</a>
              </li>
              <li>
                <a href="/new-years-2014/">Reader Submissions -<br>
                New Year's 2014</a>
              </li>
              <li>
                <a href="/multipeer-connectivity/">Multipeer
                Connectivity</a>
              </li>
              <li>
                <a href="/nshipster-quiz-4/">NSHipster Quiz #4</a>
              </li>
              <li>
                <a href=
                "/launch-arguments-and-environment-variables/">Launch
                Arguments &amp;<br>
                Environment Variables</a>
              </li>
              <li>
                <a href="/xcode-key-bindings-and-gestures/">Xcode
                Key Bindings &amp; Gestures</a>
              </li>
              <li>
                <a href="/ios7/">iOS 7</a>
              </li>
              <li>
                <a href="/network-link-conditioner/">Network Link
                Conditioner</a>
              </li>
              <li>
                <a href="/xcode-snippets/">Xcode Snippets</a>
              </li>
              <li>
                <a href="/documentation/">Documentation</a>
              </li>
              <li>
                <a href="/nshipster-quiz-3/">NSHipster Quiz #3</a>
              </li>
              <li>
                <a href="/nshipster-quiz-2/">NSHipster Quiz #2</a>
              </li>
              <li>
                <a href="/mklocalsearch/">MKLocalSearch</a>
              </li>
              <li>
                <a href="/nshipster-quiz-1/">NSHipster Quiz #1</a>
              </li>
              <li>
                <a href="/icloud/">iCloud</a>
              </li>
              <li>
                <a href="/search-kit/">Search Kit</a>
              </li>
              <li>
                <a href="/backrow/">Back Row</a>
              </li>
              <li>
                <a href=
                "/reader-submissions-new-years-2013/">Reader
                Submissions -<br>
                New Year's 2013</a>
              </li>
              <li>
                <a href="/addressbookui/">AddressBookUI</a>
              </li>
            </ul>
          </div>
        </section>
      </footer>
    </div><script type="text/javascript">
var Swiftype = window.Swiftype || {};
    (function() {
      Swiftype.key = 'Q5jNBiR8qVs5xE5dNect';
      var script = document.createElement('script');
      script.type = 'text/javascript';
      script.async = true;
      script.src = "//swiftype.com/embed.js";
      var entry = document.getElementsByTagName('script')[0];
      document.getElementsByTagName('script')[0].parentNode.insertBefore(script, entry);
    }());
    </script><script type="text/javascript">
var _gauges = _gauges || [];
    (function() {
      var t   = document.createElement('script');
      t.type  = 'text/javascript';
      t.async = true;
      t.id    = 'gauges-tracker';
      t.setAttribute('data-site-id', '510be6d4108d7b438800005f');
      t.src = '//secure.gaug.es/track.js';
      var s = document.getElementsByTagName('script')[0];
      s.parentNode.insertBefore(t, s);
    })();
    </script>
  </body>
</html>
